- name: enable ssl
  blockinfile:
    path: /etc/ood/config/ood_portal.yml
    insertbefore: "#ssl:"
    backup: yes
    marker: "# {mark} ANSIBLE MANAGED BLOCK ssl"
    block: |
      ssl:
        - 'SSLCertificateFile "/etc/pki/tls/certs/{{ ood_ssl_cert_file }}"'
        - 'SSLCertificateKeyFile "/etc/pki/tls/private/{{ ood_ssl_cert_key }}"'
  when: not ood_ssl_cert_chain_file

- name: enable ssl with chain
  blockinfile:
    path: /etc/ood/config/ood_portal.yml
    insertbefore: "#ssl:"
    backup: yes
    marker: "# {mark} ANSIBLE MANAGED BLOCK ssl"
    block: |
      ssl:
        - 'SSLCertificateFile "/etc/pki/tls/certs/{{ ood_ssl_cert_file }}"'
        - 'SSLCertificateKeyFile "/etc/pki/tls/private/{{ ood_ssl_cert_key }}"'
        - 'SSLCertificateChainFile "/etc/pki/tls/certs/{{ ood_ssl_cert_chain_file }}"'
  when: ood_ssl_cert_chain_file

- name: Build the updated Apache config
  command: /opt/ood/ood-portal-generator/sbin/update_ood_portal
  ignore_errors: yes

- name: Restart service httpd24, in all cases
  service:
    name: httpd24-httpd
    state: restarted
