---
- name: Clone the git repo to the machine
  git: 
    repo: https://github.com/uabrc/rabbitmq_agents.git
    dest: /opt/rabbitmq_agents
    version: develop

- name: Make a copy of rabbit config example file
  template:
    src: config.j2
    dest: "{{ rabbitmq_agents_loc }}/rabbit_config.py"

- name: Check if environment is properly setup, and install python packages if not
  pip:
    requirements: /opt/rabbitmq_agents/requirements.txt

#- name: Run the ood_account_create agent in the background
#  shell: cd /opt/rabbitmq_agents; nohup python ood_account_create.py </dev/null >/dev/null 2>&1 &

- name: Copy service files to the machine.
  template:
    src: ood_account.j2
    dest: "/etc/systemd/system/ood_account.service"

- name: Start ood_account.service
  service:
    name: ood_account.service
    state: started
    enabled: yes
